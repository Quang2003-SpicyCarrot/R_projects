---
title: "Assignment 1_tinytex"
author: "Quang Dong Nguyen"
date: "2023-05-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Setting up the working directory and files used in this analysis:
```{r}
setwd("C:/Users/Dell/Documents/WSU RStudio/Semester 1 - Analytics Programming/Assignment 1 (40%)")
a <- read.csv("sales_ug.csv") #daily sales data over seven day period
b <- read.csv("product_hierarchy.csv") #data containing the hierarchy and sizes of product
d <- read.csv("store_cities.csv") #data containing the city, type and size information of the stores
```
<br>

Library packages used in the report:
```{r, eval = TRUE, message = FALSE}
library(tidyverse)
library(kableExtra)
library(plotly) #for html document
```
<hr/>  


# Task 1  
Viewing the overall information about the dataset a (daily sales record of data over a seven day period)
```{r}
#viewing the dataset
head(a, 10) #head(..., 10) shows the first 10 rows of dataset a

#structure of the dataset
str(a) #show the type of data of the variables
```
<br>


### 1) Total revenue of each store at the end of each day
To calculate the revenue of each store at the end of each day, using `aggregate()` 
is the best choice of algorithm, as it can split data into subsets and compute summary statistics
for each.  
The function below summarise the statistic of revenue based on the store_id and date variables.
In this case, it sums the total revenue made based on the store_id and date. 
```{r}
revenue_each_day <- aggregate(revenue ~ store_id + date, #calculate revenue based on store_id and date variables
                              data = a, 
                              FUN = sum) #summation is abbreviated to sum
head(revenue_each_day, 10) 
```
The above table demonstrates the total revenue of each store profited by the end of each day, 
starting from date 3 June to 9 June of 2017.  
The stores are shown by `store_id` while the `date` shows the days for which the `revenue` is shown. For example:  
1. Store with unique identifier number of `r revenue_each_day$store_id[1]` obtained a total revenue of `r revenue_each_day$revenue[1]`
on the date `r revenue_each_day$date[1]`.  
2. Store with unique identifier number of `r revenue_each_day$store_id[2]` obtained a total revenue of `r revenue_each_day$revenue[2]`
on the date `r revenue_each_day$date[2]`.  
3. Store with unique identifier number of `r revenue_each_day$store_id[100]` obtained a total revenue of `r revenue_each_day$revenue[100]`
on the date `r revenue_each_day$date[100]`. And so on.

<br>


### 2) Differences in revenues between the day?
To see the difference in revenues between the day, we can use `tapply()` to provide mathematical function to columns
that use the function. In this example, `diff` is a function value that is used to calculated the differences in revenues
obtained between each row where store_id is matched with the previous row.
```{r}
tapply(revenue_each_day$revenue, 
       revenue_each_day$store_id, 
       diff) %>% #each array element represents the difference in revenue between 
  head(10)       #the current day and the next day
           
```
<br>

In this example, `tapply()` returns values in the form of arrays.
It is a poor way to arrange data, however this is the only current available option for my personal choice of algorithm.
```{r}
class(tapply(revenue_each_day$revenue, revenue_each_day$store_id, diff))
#returns values in the form of arrays.
```
<br>


### 3) Total revenue generated by each store over seven days 
```{r}
revenue_seven <- aggregate(revenue ~ store_id, 
                           data = a, 
                           FUN = sum) #summarise the total revenue made from each store_id over the seven days
                                      #function applied to summarise the revenue statistic is sum (summation).
head(revenue_seven, 10)
```
The above table portrays the first 10 values of the total revenue of each store over the seven day period. For example:  
1. Store with `store_id` (unique identifier number) of `r revenue_seven$store_id[1]` has gained a total revenue of `r revenue_seven$revenue[1]`.  
2. Store with `store_id` of `r revenue_seven$store_id[2]` has gained a total revenue of `r revenue_seven$revenue[2]`.  
3. Store with `store_id` of `r revenue_seven$store_id[50]` has gained a total revenue of `r revenue_seven$revenue[50]`.
And so on

<br>


### Plotting:
```{r, eval = FALSE}
#ggplot the whole graph with everystore and its total revenue over seven days
ggstoreid_rev <- ggplot(revenue_seven, aes(store_id, revenue)) + #aesthetic mapping x and y-axis with store_id and revenue
  geom_point() +                                #create points with x as store_id and y as revenue
  theme_bw() +                                  #change the background theme of the graph to white 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Total revenue obtained over seven days by each store",
       caption = "*Note: the ggplot shows the ")

ggplotly(ggstoreid_rev)
```
<br>

```{r}
#plotting the total revenue over the seven day period
ggplot(revenue_seven, aes(store_id, revenue)) +
  geom_point() +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90)) +
  coord_cartesian(xlim = c(0, 28)) + #showing the revenues obtained by the first 30 stores 
  labs(title = "Total revenue obtained over seven days by each store",
       caption = "The plot shows only the first 30 stores' revenues due to overloading of data.
       Note: revenue - daily total sales revenue
             store_id - unique identifier of a store")
```

<br>
<hr/>  


# Task 2:  
Viewing information about the dataset b (product_hierarchy data)
```{r}
#viewing the dataset
head(b, 10) #shows the first 10 variables of dataset b

#structure of the dataset
str(b) #shows the structure of b and its datax
```
<br>


### 1) The most popular product type (hierarchy 1) sold in all stores over a week
To check for the popularity ranking of the product type (hierarchy 1) in terms of selling, we use `sort()` to 
sort table values. By using `decreasing = TRUE` as additional argument, it sorts table values from the highest to the lowest.
```{r}
sort(table(b$hierarchy1_id), decreasing = TRUE)#product named H03 are most popularly sold

```
As it can be seen in the above table, the most sold product type is H03 with 292 items sold
over the week. And the second most popular product type sold is H00 with 215 items sold over the week.  

<br>


### 2) How much revenue did the stores receive for that product during the week?  
Joining two datasets a and b based on their corresponding variables. In this case the corresponding keys
are product_id, and the joining variables are hierarchy1_id and hierarchy2_id
```{r}
merged_ab_tab <- b %>% 
  select("product_id", "hierarchy1_id", "hierarchy2_id") %>%
  right_join(a)
head(merged_ab_tab, 10)
```
<br>

Revenue received from that product during the week:
```{r}
#revenue made
stores_rev_made <- merged_ab_tab[which(merged_ab_tab$hierarchy1_id == "H03"),]
aggregate(revenue ~ store_id + date, data = stores_rev_made, sum) %>%
  head(10) #shows the first 10 values of revenues made from products with hierarchy1_id of "H03"
```
As shown in the table above, Each store has received a various amount of revenue over each days. For instance,
Store with the store_id of S0001 has made a total of 268.05 on the date of 3/7/2017.
While store with the store_id of S0003 has only made a total of 9.25 on the date of 3/7/2017
on the same product as the store with store_id of S0001.  

Furthermore, there are also stores that made zero revenue on some days, for example,
store with the store_id of S0009 has made zero revenue on that product on the date of 3/7/2017.  

Therefore, the revenues generated from each store are unique.  

<br>


### 3) How does that compare with the second most popular product?
The second most popular product is "H00" according to the sorted table above.  
```{r}
stores_rev_made <- merged_ab_tab[which(merged_ab_tab$hierarchy1_id == "H00"),]
aggregate(revenue ~ store_id + date, data = stores_rev_made, sum) %>%
  head(10) #total revenue made in each store from the products with hierarchy1_id "H00" during the week
```
needs to be fixed

<br>


### 4) Provide a table showing the product type ranked from most to least popular
```{r}
sort(table(b$hierarchy1_id), decreasing = TRUE)
```
The table above shows the ranking of product type from most to least, where the
most and least popular product types are H03 and H02.  

<br>

### 5) For each product: how many subtypes products are there?
```{r}
matx_1 <- table(b$hierarchy1_id, b$hierarchy2_id)
matx_1
```
As described in the description of variables, each product has subtype products corresponded to
and is categorised into levels of hierarchy. According to the hierarchy table shown above:  
- There are 5 subtype products of H00: H0000, H0001, H0002, H0003, H0004.
- There are 4 subtype products of H01: H0105, H0106, H0107, H0108.  
- There are 2 subtype products of H02: H0209, H0311.  
- There are 7 subtype products of H03: H0311, H0312, H0313, H0314, H0315, H0316, H0317.  


<br>


### 6) How many products are in this product type?
As shown in the matrix table `matx_1` above:  
- There are `r matx_1[1,1]` items in `r colnames(matx_1)[1]` (subset of `r rownames(matx_1)[1]`).  
- There are `r matx_1[1,2]` items in `r colnames(matx_1)[2]` (subset of `r rownames(matx_1)[1]`). 
- And so on.

<br>


### 7) Sales quantity:
```{r}
#hierarchy1_id:
aggregate(sales ~ hierarchy1_id, data = merged_ab_tab, sum)
```
There are four product types, and each made a unique number of sales over the seven days:  
- H00 has made a total sale of `r aggregate(sales ~hierarchy1_id, data = merged_ab_tab, sum)[2,1]`.    
- H01 has made a total sale of `r aggregate(sales ~hierarchy1_id, data = merged_ab_tab, sum)[2,2]`.  
- H02 has made a total sale of `r aggregate(sales ~hierarchy1_id, data = merged_ab_tab, sum)[2,3]`. 
- H03 has made a total sale of `r aggregate(sales ~hierarchy1_id, data = merged_ab_tab, sum)[2,4]`.  

<br>

```{r}
#hierarchy2_id:
aggregate(sales ~ hierarchy1_id + hierarchy2_id, data = merged_ab_tab, sum) %>%
  head(10) #shows the first 10 values of sale obtained
```
Total sale made based on the second level of hierarchy (hierarchy2_id). For instance:  
- In a week, the total sale produced by selling products where the first level of hierarchy is H00
and the second level of hierarchy is H0000 was 13093.000.  
- Meanwhile, the total sale  produced by selling products where the first hierarchy level is H00
and the second hierarchy level is H0001 was 2481.000.  

Insight:  
The most popular subtype of H00 sold in all stores is H0003 with a total sale of 17,920.000 made over the seven days.
And the second most popular subtype of H00 sold in all stores is H0000 with a total sale of 13,093.000 made over the seven days.  

<br>


### 8) Revenue generated by each product type:
```{r}
#hierarchy1_id
aggregate(revenue ~ hierarchy1_id, data = merged_ab_tab, sum)
```
The total revenue obtained by each product type over the seven day period shows that:  
- The top ranked product type is H00,which has obtained a total revenue of $100,165.44 over seven days.
- Meanwhile, the second-ranked product type is H01,which has obtained a total revenue of $61,773.15.  
- And, the last ranked product type is H02,which has obtained a total revenue of $12,221.22.  

<br>

```{r}
#hierarchy2_id:
aggregate(revenue ~ hierarchy1_id + hierarchy2_id, data = merged_ab_tab, sum) %>%
  head(10)
```
Total revenue made asaed on the second level of hierarchy (hierarchy2_id).  
- The most sold item in H00 is H0000 with a total of $35,413.54 made over the week.  
- And the least sold item in H00 is H0001, with a total of $9,207.45 made over the week.  

<br>
<hr/>


# Task 3:
View information about the dataset d (store_cities data)
```{r}
#Viewing the first 10 values of the dataset
head(d, 10)
```
<br>

```{r}
#structure of the dataset
str(d)
```
<br>


### Compare the Sales volumes between the two most common store types in the data set.  
Sorting store types accross the stores cities data set:
```{r}
sort(table(d$storetype_id), decreasing = TRUE)
```
Ranking from most to least, there are:  
- ST04 is the most common storetype with over 83 stores accross cities. 
- ST02 and ST01 are the least common storetypes accross cities, with only 4 stores for each.  


<br>

Joining two datasets a and d together
```{r}
#right join dataset d and a according to the corresponding id:
merged_da_tab <- d %>% 
  select("store_id", "storetype_id", "store_size") %>%
  right_join(a)
head(merged_da_tab, 10)
```
<br>

```{r}
#sales volume of ST03 and ST04
aggregate(sales ~ storetype_id, data = merged_da_tab, sum)[c(3,4),]
```
In terms of sales, Stores with storetype_id ST03 has gained a total of 7980 in sale volume while
stores with the store_id ST04 has gained a total of 35,556 in sale volume over the seven days.
This means that stores with the storetype_id ST04 is more potential than the other,
since the difference in the volume of sale made over a week is at least 5 times over the other.

<br>

```{r}
#difference in sales volume between ST04 and ST03

```
<br>


### How do they compare in terms of total revenue?
```{r}
#Total revenue of ST03 and ST04
aggregate(revenue ~ storetype_id, data = merged_da_tab, sum)[c(3,4),]
```
<br>


### Is there a relationship betwen a store's size and its revenue?
```{r, include = FALSE}
#plot #remember to remove this after finishing
ggplot(data = merged_da_tab, aes(store_size, revenue)) +
  geom_point()
```


```{r}
summary(lm(revenue~store_size, data = merged_da_tab))
```
<br>
<hr/>


# Task 4:
### For each promotion type, display the different levels of promotion during the period
```{r}
#Different levels of promotion
table(a$promo_type_1, a$promo_bin_1)
```
Each promotion type has a unique level of ranking, from very high to very low. 
Except PR14, it has one level of promotion and is not categorised to any level of ranking (high-to-low).  

<br>


```{r}
#Uses of promotion accross the seven day period
table(a$date, a$promo_type_1)
```
However, as it can be seen, the most commonly used promotion accross the seven days was PR14, with more over
13400 promotions were used on each day in every stores accross cities.

<br>


### Analyse the effectiveness of the promotion on the sales of the products
```{r}

```

